<?xml version="1.0"?>
<openerp>
    <data>
        <record id="res_company_carrier_page_form" model="ir.ui.view">
            <field name="name">res.company.carrier.page.form</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="base.view_company_form" />
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <page name="carrier_page" string="Corriere MBE">
                        <group col="2">
                            <field name="carrier_save_label" />
                            <field name="carrier_save_label_path" attrs="{'invisible': [('carrier_save_label', '=', False)], 'required': [('carrier_save_label', '=', True)]}"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_confirm">
			<field name="name">Carrier: confirm orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">1</field>
			<field name="type">ir.actions.server</field>
			<!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                   order.set_carrier_ok_yes()
			</field>
		</record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_cancel">
			<field name="name">Carrier: cancel orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">2</field>
			<field name="type">ir.actions.server</field>
            <!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                   order.set_carrier_ok_no()
			</field>
		</record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_sent">
			<field name="name">Carrier: sent orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">3</field>
			<field name="type">ir.actions.server</field>
            <!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                    order.set_carrier_ok_sent()
			</field>
		</record>

        <!--SHIPMENT VIEWS:-->
        <!--<record id="carrier_sale_order_error_detail_form" model="ir.ui.view">
            <field name="name">wordpress.sale.order.shipment</field>
            <field name="model">wordpress.sale.order</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <form string="Error detail">
                    <header>
                        <button string="Close" special="cancel" />
                    </header>
                    <sheet>
                        <group>
                            <separator string="Last error detail:" colspan="4"/>
                            <field name="soap_last_error" colspan="4" nolabel="1" readonly="1"/>
                        </group>
                    </sheet>
                    <footer></footer>
                </form>
            </field>
        </record>-->
        <record id="carrier_sale_order_tree" model="ir.ui.view">
            <field name="name">wordpress.sale.order.shipment</field>
            <field name="model">wordpress.sale.order</field>
            <field name="priority" eval="40"/>

            <field name="arch" type="xml">
                <tree string="Sale order for carrier" editable="bottom" colors="green: carrier_soap_state == 'delivered';blue: carrier_soap_state == 'pending'; grey:carrier_state == 'draft' and (len(parcel_ids) == 0 or not carrier_supplier_id)" >
                    <!--<field name="connector_id"/>
                    <field name="wp_date_created"/>
                    -->
                    <field name="name" readonly="1"/>
                    <field name="partner_name" readonly="1"/>
                    <field name="shipping" readonly="1"/>

                    <field name="carrier_parcel_template_id" domain="['|',('carrier_supplier_id','=',False),('carrier_supplier_id','=',carrier_supplier_id)]" />
                    <field name="parcel_weight_tree" />
                    <button name="load_template_parcel" string="Add parcel" icon="fa-plus fa-2x" type="object" attrs="{'invisible': [('carrier_parcel_template_id','=',False)]}" class="oe_highlight"/>

                    <field name="parcel_detail" readonly="1"/>
                    <field name="parcel_ids" invisible="1"/>
                    <field name="ship_type" invisible="1"/>
                    <field name="package_type" invisible="1"/>
                    <field name="carrier_cost_lossy" invisible="1"/>

                    <field name="carrier_supplier_id"/>
                    <field name="carrier_mode_id" />
                    <button name="carrier_get_better_option" type="object" string="Get better option" icon="fa-hand-o-right fa-2x" />
                    <field name="courier_supplier_id" /> <!--readonly="1"-->
                    <field name="courier_mode_id" /> <!--readonly="1"-->
                    <field name="master_tracking_id" readonly="1"/>
                    <field name="carrier_track_id" readonly="1"/>
                    <field name="carrier_cost" readonly="1"/>
                    <field name="carrier_state"/>
                    <field name="carrier_ok" invisible="1"/>

                    <!--<field name="soap_last_error" invisible="1"/>
                    <button name="soap_comment_last_error" string="Last error present" type="object" attrs="{'invisible': [('soap_last_error', '=', False)]}" icon="fa-exclamation-triangle fa-2x" />-->

                    <button name="set_carrier_ok_yes" string="Delivery confirmed" type="object" attrs="{'invisible': [('carrier_ok', '=', True)]}" icon="fa-dropbox fa-2x" />
                    <button name="set_carrier_ok_no" string="Delivery undo" type="object" attrs="{'invisible': [('carrier_ok', '=', False)]}" icon="fa-mail-reply fa-2x" />
                    <button name="carrier_print_label" type="object" string="Print label" icon="fa-film fa-2x" attrs="{'invisible': [('carrier_track_id', '=', False)]}"/>
                    <button name="order_form_detail" type="object" string="Get better option" icon="fa-arrows fa-2x"/>
                    <field name="state" invisible="1"/>
                    <field name="carrier_state" invisible="1"/>
                    <!--<field name="carrier_delivery_state" invisible="1"/>-->
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>
        <record id="carrier_sale_order_action" model="ir.actions.act_window">
            <field name="name">Carrier sale order</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', 'in', ('draft', 'pending')),('state', 'not in', ('on-hold', 'pending'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_sent" model="ir.actions.act_window">
            <field name="name">Carrier order sent</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'sent')]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_delivered" model="ir.actions.act_window">
            <field name="name">Carrier order delivered</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'delivered'),]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_lossy" model="ir.actions.act_window">
            <field name="name">Carrier order lossy</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_cost_lossy', '=', True)]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>



        <record model="ir.ui.view" id="view_sale_order_carrier_search">
            <field name="name">wordpress.sale.order.carrier.search</field>
            <field name="model">wordpress.sale.order</field>
            <field name="inherit_id" ref="wordpress_sale_order_view_search"/>
            <field name="arch" type="xml">
                <field name="currency" position="after">
                    <field name="carrier_track_id" />
                    <field name="carrier_supplier_id" />
                    <field name="carrier_mode_id" />
                    <field name="courier_supplier_id" />
                    <field name="courier_mode_id" />

                    <filter name="carrier_track_id_assigned" string="LDV generated" domain="[('carrier_track_id','!=',False)]"/>

                </field>
                <xpath expr="/search/group/filter[2]" position="after">
                    <filter string="Carrier supplier" domain="[]" context="{'group_by': 'carrier_supplier_id'}"/>
                    <filter string="Carrier mode" domain="[]" context="{'group_by': 'carrier_mode_id'}"/>

                    <filter string="Courier supplier" domain="[]" context="{'group_by': 'courier_supplier_id'}"/>
                    <filter string="Courier mode" domain="[]" context="{'group_by': 'courier_mode_id'}"/>

                    <filter string="Carrier delivered date" domain="[]" context="{'group_by': 'carrier_delivery_date'}"/>
                    <filter string="Carrier signed date" domain="[]" context="{'group_by': 'carrier_delivery_sign'}"/>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="wordpress_sale_order_carrier_view_form">
            <field name="name">wordpress.sale.order.form</field>
            <field name="model">wordpress.sale.order</field>
            <field name="inherit_id" ref="wp_order.wordpress_sale_order_view_form"/>
            <field name="arch" type="xml">
                <field name="key" position="after">
                    <field name="carrier_connection_id" /> <!--attrs="{'invisible': [('soap_connection_id', '=', False)]}"-->
                </field>
                <xpath expr="//page[1]" position="after">
                    <page string="Carrier" name="carrier_page">
                        <group colspan="4" col="5">
                            <button name="set_carrier_ok_yes" string="Delivery confirmed" type="object" attrs="{'invisible': [('carrier_ok', '=', True)]}" icon="gtk-yes" colspan="1"/>
                            <button name="set_carrier_ok_no" string="Delivery undo" type="object" attrs="{'invisible': [('carrier_ok', '=', False)]}" icon="gtk-no" colspan="1"/>
                            <newline/>
                            <field name="carrier_ok" invisible="1" />
                        </group>

                        <group colspan="4" col="5" >
                            <field name="carrier_supplier_id" />
                            <field name="carrier_mode_id" />
                            <button name="carrier_get_better_option" type="object" string="Get better option" icon="fa-hand-o-left"/>

                            <field name="carrier_parcel_template_id" domain="['|',('carrier_supplier_id','=',False),('carrier_supplier_id','=',carrier_supplier_id)]"/>
                            <button name="load_template_parcel" string="Add" type="object" attrs="{'invisible': [('carrier_parcel_template_id','=',False)]}" colspan="1" class="oe_highlight"/>
                            <newline/>

                            <separator string="Parcel:" colspan="5"/>
                            <field name="parcel_ids" colspan="5" nolabel="1">
                                <tree string="Parcel" editable="bottom">
                                    <field name="length" />
                                    <field name="width" />
                                    <field name="height" />

                                    <field name="real_weight" sum="total_real"/>
                                    <field name="use_real_weight" />
                                    <field name="weight" sum="total_volumetric"/>
                                    <field name="no_label" />
                                </tree>
                            </field>
                            <newline/>
                        </group>

                        <group colspan="4" col="5">
                            <separator string="Partner check:" colspan="5"/>
                            <field name="carrier_check" colspan="5" readonly="1" nolabel="1" widget="html"/>
                            <newline/>
                        </group>

                        <group colspan="4" col="5" >
                            <separator string="Request:" colspan="4"/>
                            <button name="set_default_carrier_description" string="Force description" type="object" icon="gtk-execute"/>
                            <field name="carrier_description" colspan="5" />
                            <newline/>

                            <field name="carrier_note" />
                            <field name="carrier_stock_note" />
                            <newline/>

                            <field name="carrier_total" />
                            <field name="carrier_cash_delivery" />
                            <newline/>

                            <field name="carrier_ensurance" />
                            <field name="carrier_pay_mode" />
                            <newline/>
                        </group>

                        <!-- Common part: -->
                        <group colspan="4" col="5">
                            <separator string="Carrier reply:" colspan="5"/>
                            <field name="carrier_cost" />
                            <field name="carrier_track_id" />
                            <newline/>
                            <field name="courier_supplier_id" />
                            <field name="courier_mode_id" />
                            <newline/>
                            <field name="carrier_delivery_date" />
                            <field name="carrier_delivery_sign" />
                            <newline/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!--carrier.supplier-->
        <record model="ir.ui.view" id="view_carrier_supplier_tree">
            <field name="name">carrier.supplier.tree</field>
            <field name="model">carrier.supplier</field>
            <field name="arch" type="xml">
                <tree string="Carrier supplier" editable="bottom">
                    <field name="hidden" />
                    <field name="mode_id" />
                    <field name="name" />
                    <field name="account_ref" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_supplier_form">
            <field name="name">Carrier supplier</field>
            <field name="res_model">carrier.supplier</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_carrier_supplier_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--carrier.supplier.mode-->
        <record model="ir.ui.view" id="view_carrier_supplier_mode_tree">
            <field name="name">carrier.supplier.mode.tree</field>
            <field name="model">carrier.supplier.mode</field>
            <field name="arch" type="xml">
                <tree string="Carrier supplier mode" editable="bottom">
                    <field name="hidden" />
                    <field name="supplier_id" />
                    <field name="name" />
                    <field name="account_ref" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_supplier_mode">
            <field name="name">Carrier mode</field>
            <field name="res_model">carrier.supplier.mode</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_carrier_supplier_mode_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--carrier.parcel.template-->
        <record model="ir.ui.view" id="view_carrier_parcel_template_tree">
            <field name="name">carrier.parcel.template.tree</field>
            <field name="model">carrier.parcel.template</field>
            <field name="arch" type="xml">
                <tree string="Parcel template" editable="bottom" decoration-primary="carrier_supplier_id==False">
                    <field name="carrier_supplier_id" />
                    <field name="carrier_connection_id" />
                    <field name="package_type" />

                    <field name="name" />
                    <field name="length" />
                    <field name="width" />
                    <field name="height" />
                    <field name="weight" />
                    <field name="no_label" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_carrier_parcel_template_form">
            <field name="name">carrier.parcel.template.form</field>
            <field name="model">carrier.parcel.template</field>
            <field name="arch" type="xml">
                <form string="Parcel template">
                    <sheet>
                        <group colspan="4" col="6">
                            <field name="carrier_supplier_id" />
                            <field name="carrier_connection_id" />
                            <field name="package_type" />

                            <field name="name" />
                            <field name="weight" />

                            <field name="length" />
                            <field name="width" />
                            <field name="height" />

                            <field name="no_label" />
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_parcel_template_tree">
            <field name="name">Parcel template</field>
            <field name="res_model">carrier.parcel.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_carrier_parcel_template_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <menuitem
            parent="connector_web_base.menu_webserver_root"
            id="menu_connector_wordpress_carrier"
            name="Corriere"
            sequence="30"
            />
            <menuitem
                    parent="menu_connector_wordpress_carrier"
                    id="menu_parcel_template"
                    action="action_carrier_parcel_template_tree"
                    sequence="10"
                    />
                <menuitem
                    parent="menu_connector_wordpress_carrier"
                    id="menu_carrier_supplier"
                    action="action_carrier_supplier_form"
                    sequence="20"
                    />
                <menuitem
                    parent="menu_connector_wordpress_carrier"
                    id="menu_carrier_supplier_mode"
                    action="action_carrier_supplier_mode"
                    sequence="30"
                    />

    </data>
</openerp>
