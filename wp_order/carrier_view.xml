<?xml version="1.0"?>
<openerp>
    <data>
        <!--carrier.supplier.stored.data-->
        <record id="carrier_supplier_stored_data_view_search" model="ir.ui.view">
            <field name="name">carrier.supplier.stored.data.search</field>
            <field name="model">carrier.supplier.stored.data</field>
            <field name="arch" type="xml">
                <search string="Spedizioni storicizzate">
                    <field name="product_id" />
                    <field name="default_code" />
                    <filter name="this_database" string="DB corrente" domain="[('linked_product_ref', '=', False)]"/>
                    <filter name="other_database" string="DB collegato" domain="[('linked_product_ref', '!=', False)]"/>
                </search>
            </field>
        </record>
        <record id="carrier_supplier_stored_data_view_tree" model="ir.ui.view">
            <field name="name">carrier.supplier.stored.data.tree</field>
            <field name="model">carrier.supplier.stored.data</field>
            <field name="arch" type="xml">
                <tree string="Storico spedizioni">
                    <field name="product_id"/>
                    <field name="linked_product_ref"/>
                    <field name="default_code" />
                </tree>
            </field>
        </record>
        <record id="carrier_supplier_stored_data_view_form" model="ir.ui.view">
            <field name="name">carrier.supplier.stored.data.form</field>
            <field name="model">carrier.supplier.stored.data</field>
            <field name="arch" type="xml">
                <form string="Storico spedizioni">
                    <sheet>
                        <group col="4">
                            <field name="product_id"/>
                            <field name="linked_product_ref"/>
                            <field name="default_code" />
                            <notebook colspan="4">
                                <page name="page_shipping" string="Spedizioni">
                                    <group col="4">
                                        <separator string="Spedizioni" colspan="4"/>
                                        <field name="json_data_html" widget="html" colspan="4" nolabel="1" readonly="1"/>
                                    </group>
                                </page>
                                <page name="page_zone" string="Costi zona">
                                    <group col="4">
                                        <separator string="Costi" colspan="4"/>
                                        <field name="json_zone" colspan="4" nolabel="1" readonly="1"/>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="action_carrier_supplier_stored_data" model="ir.actions.act_window">
            <field name="name">Storico spedizioni prodotto</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">carrier.supplier.stored.data</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="view_id" ref="carrier_supplier_stored_data_view_tree"/>
        </record>

        <!--sale.order.carrier.constraint-->
        <record id="sale_order_carrier_constraint_view_tree" model="ir.ui.view">
            <field name="name">sale.order.carrier.constraint.tree</field>
            <field name="model">sale.order.carrier.constraint</field>
            <field name="arch" type="xml">
                <tree string="Vincoli" editable="bottom">
                    <field name="mode"/>
                    <field name="formula" attrs="{'required': [('mode', '=', 'formula')], 'readonly': [('mode', '!=', 'formula')]}"/>
                    <field name="value" attrs="{'required': [('mode', '!=', 'formula')], 'readonly': [('mode', '=', 'formula')]}"/>
                </tree>
            </field>
        </record>

        <!--product.product.web.server-->
        <record id="product_product_web_server_view_tree" model="ir.ui.view">
            <field name="name">product.product.web.server.tree</field>
            <field name="model">product.product.web.server</field>
            <field name="arch" type="xml">
                <tree string="Pallet auto trasportatore:" editable="bottom" colors="red: web_volumetric == 0">
                    <field name="published" readonly="1"/>
                    <field name="product_id" readonly="1"/>
                    <field name="connector_id" readonly="1"/>
                    <field name="wp_color_id" readonly="1"/>
                    <!--<field name="wp_type" readonly="1"/>
                    <field name="wp_parent_code" readonly="1"/>-->

                    <field name="web_W"/>
                    <field name="web_L"/>
                    <field name="web_H"/>
                    <field name="web_weight"/>
                    <field name="web_volumetric"/>

                    <field name="carrier_extra"/>
                </tree>
            </field>
        </record>
        <record id="product_product_web_server_transport_view_tree" model="ir.ui.view">
            <field name="name">product.product.web.server.transport.tree</field>
            <field name="model">product.product.web.server</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <tree string="Trasporto prodotto">
                    <field name="published" readonly="1"/>
                    <field name="product_id" readonly="1"/>
                    <field name="connector_id" readonly="1"/>
                    <field name="wp_color_id" readonly="1"/>

                    <field name="web_W"/>
                    <field name="web_L"/>
                    <field name="web_H"/>
                    <field name="web_weight"/>
                    <field name="web_volumetric"/>

                    <field name="carrier_extra"/>
                </tree>
            </field>
        </record>
        <record id="product_product_web_server_transport_view_form" model="ir.ui.view">
            <field name="name">product.product.web.server.form</field>
            <field name="model">product.product.web.server</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <form string="Trasporto prodotto">
                    <sheet>
                        <group col="4">
                            <field name="published" readonly="1"/>
                            <field name="product_id" readonly="1"/>
                            <field name="connector_id" readonly="1"/>
                            <field name="wp_color_id" readonly="1"/>

                            <field name="web_W"/>
                            <field name="web_L"/>

                            <field name="web_H"/>
                            <field name="carrier_extra"/>

                            <field name="web_weight"/>
                            <field name="web_volumetric"/>

                            <separator string="Corrieri preferenziali" colspan="4"/>
                            <field name="courier_ids" colspan="4" nolabel="1">

                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="action_product_product_web_server" model="ir.actions.act_window">
            <field name="name">Prodotti dimensioni</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.product.web.server</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('wp_parent_template', '=', True)]</field>
            <field name="view_id" ref="product_product_web_server_view_tree"/>
        </record>
        <record id="action_product_product_web_transport_server" model="ir.actions.act_window">
            <field name="name">Prodotti per trasporti</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.product.web.server</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('wp_parent_template', '=', True)]</field>
            <field name="context">{'form_view_ref': 'wp_order.product_product_web_server_transport_view_form'}</field>
            <field name="view_id" ref="product_product_web_server_transport_view_tree"/>
        </record>

        <!--product.product.courier-->
        <record id="product_product_courier_view_tree" model="ir.ui.view">
            <field name="name">product.product.courier.tree</field>
            <field name="model">product.product.courier</field>
            <field name="arch" type="xml">
                <tree string="Trasporto consigliato:" editable="bottom">
                    <field name="sequence" widget="handle"/>
                    <field name="product_id" invisible="1"/>
                    <field name="courier_id" domain="[('broker_id', '!=', False)]"/>
                    <field name="broker_id" readonly="1"/>
                    <field name="pallet_id" /><!--domain="[('broker_id', '=', broker_id)]"-->
                    <field name="base_cost"/>
                </tree>
            </field>
        </record>
        <record id="action_product_product" model="ir.actions.act_window">
            <field name="name">Prodotti per trasporti</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.product.courier</field>
            <field name="view_mode">tree</field>
            <field name="domain">[]</field>
            <field name="view_id" ref="product_product_courier_view_tree"/>
        </record>

        <!--sale.order.carrier.pallet-->
        <record id="sale_order_carrier_pallet_view_tree" model="ir.ui.view">
            <field name="name">sale.order.carrier.pallet.tree</field>
            <field name="model">sale.order.carrier.pallet</field>
            <field name="arch" type="xml">
                <tree string="Pallet autotrasportatore:" editable="bottom">
                    <field name="name"/>
                    <field name="broker_id" invisible="1"/>
                    <field name="base"/>
                    <field name="W"/>
                    <field name="L"/>
                    <field name="H"/>
                    <field name="weight"/>
                </tree>
            </field>
        </record>

        <!--sale.order.carrier.zone.extra-->
        <record id="sale_order_carrier_zone_extra_view_tree" model="ir.ui.view">
            <field name="name">sale.order.carrier.zone.extra.tree</field>
            <field name="model">sale.order.carrier.zone.extra</field>
            <field name="arch" type="xml">
                <tree string="Costi extra:" editable="bottom">
                    <field name="sequence" widget="handle"/>
                    <field name="courier_id" invisible="1"/>
                    <field name="is_active" invisible="1"/>
                    <field name="mode"/>
                    <field name="formula" attrs="{'readonly': [('mode', '!=', 'formula')], 'required': [('mode', '=', 'formula')]}"/>
                    <field name="value" attrs="{'readonly': [('mode', 'not in', ('weight', '1dimension', '2dimension', '3dimension'))], 'required': [('mode', 'in', ('weight', '1dimension', '2dimension', '3dimension'))]}"/>
                    <field name="value_zone_id"  attrs="{'readonly': [('mode', '!=', 'zone')], 'required': [('mode', '=', 'zone')]}" domain="[('courier_id', '=', courier_id)]"/>
                    <field name="price"/>
                    <field name="date"/>
                    <button name="new_price_history_this" string="Storicizza per cambio prezzo" icon="gtk-new"/>
                </tree>
            </field>
        </record>

        <record id="carrier_connection_view_tree" model="ir.ui.view">
            <field name="name">carrier.connection.view.tree</field>
            <field name="model">carrier.connection</field>
            <field name="arch" type="xml">
                <tree string="Carrier Connection">
                    <field name="name"/>
                    <field name="company_id"/>
                    <field name="location"/>
                    <field name="username"/>
                    <field name="passphrase" invisible="1"/>
                    <field name="system"/>
                    <field name="internal_reference"/>
                    <field name="customer_id"/>
                    <field name="store_id"/>
                    <field name="sam_id"/>
                    <field name="department_id"/>
                </tree>
            </field>
        </record>
        <record id="carrier_connection_view_form" model="ir.ui.view">
            <field name="name">carrier.connection.view.form</field>
            <field name="model">carrier.connection</field>
            <field name="arch" type="xml">
                <form string="Carrier Connection">
                    <header>

                    </header>
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="name"/>
                            <field name="company_id"/>

                            <field name="location" colspan="4"/>

                            <field name="username"/>
                            <field name="passphrase" />

                            <field name="system"/>
                            <field name="internal_reference"/>

                            <field name="customer_id"/>
                            <field name="store_id"/>

                            <field name="sam_id"/>
                            <field name="department_id"/>

                            <field name="auto_print_label" />
                            <field name="cups_printer_id" />

                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="carrier_connection_action" model="ir.actions.act_window">
            <field name="name">Carrier Connection</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">carrier.connection</field>
            <field name="view_mode">tree,form</field>
        </record>


        <!--res.company-->
        <record id="res_company_carrier_page_form" model="ir.ui.view">
            <field name="name">res.company.carrier.page.form</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="base.view_company_form" />
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <page name="carrier_page" string="Corriere MBE">
                        <group col="2">
                            <field name="carrier_save_label" />
                            <field name="carrier_save_label_path" attrs="{'invisible': [('carrier_save_label', '=', False)], 'required': [('carrier_save_label', '=', True)]}"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_confirm">
			<field name="name">Carrier: confirm orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">1</field>
			<field name="type">ir.actions.server</field>
			<!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                   order.set_carrier_ok_yes()
			</field>
		</record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_cancel">
			<field name="name">Carrier: cancel orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">2</field>
			<field name="type">ir.actions.server</field>
            <!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                   order.set_carrier_ok_no()
			</field>
		</record>
		<record model="ir.actions.server" id="ir_actions_server_order_carrier_sent">
			<field name="name">Carrier: sent orders</field>
			<field name="model_id" ref="model_wordpress_sale_order"/>
			<field name="sequence">3</field>
			<field name="type">ir.actions.server</field>
            <!--<field name="multi">true</field>-->
			<field name="state">code</field>
			<field name="code">
				for order in records:
                    order.set_carrier_ok_sent()
			</field>
		</record>

        <!--SHIPMENT VIEWS:-->
        <!--<record id="carrier_sale_order_error_detail_form" model="ir.ui.view">
            <field name="name">wordpress.sale.order.shipment</field>
            <field name="model">wordpress.sale.order</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <form string="Error detail">
                    <header>
                        <button string="Close" special="cancel" />
                    </header>
                    <sheet>
                        <group>
                            <separator string="Last error detail:" colspan="4"/>
                            <field name="soap_last_error" colspan="4" nolabel="1" readonly="1"/>
                        </group>
                    </sheet>
                    <footer></footer>
                </form>
            </field>
        </record>-->
        <record id="carrier_sale_order_tree" model="ir.ui.view">
            <field name="name">wordpress.sale.order.shipment</field>
            <field name="model">wordpress.sale.order</field>
            <field name="priority" eval="40"/>

            <field name="arch" type="xml">
                <tree string="Sale order for carrier" editable="bottom" fonts="bold:is_prime == True"  colors="green: carrier_state == 'delivered';blue: carrier_state == 'pending'; grey:carrier_state == 'draft' and (not parcel_ids or not carrier_supplier_id)" >

                    <button name="delivery_today_on" type="object" string="Consegna oggi!" icon="star-on" attrs="{'invisible': [('traking_date', '!=', False)]}"/>
                    <button name="delivery_today_off" type="object" string="Non consegnare oggi" icon="star-off" attrs="{'invisible': [('traking_date', '=', False)]}"/>

                    <!--
                    todo restore after check code:
                    <button name="set_carrier_ok_yes" string="Delivery confirmed" type="object" attrs="{'invisible': [('carrier_ok', '=', True)]}" icon="gtk-yes" />
                    <button name="set_carrier_ok_no" string="Delivery undo" type="object" attrs="{'invisible': [('carrier_ok', '=', False)]}" icon="gtk-undo" />-->

                    <!--<field name="carrier_delivery_state" invisible="1"/>-->
                    <button name="order_form_detail" type="object" string="Dettaglio ordine" icon="gtk-find"/>
                    <button name="extract_wordpress_published_report" type="object" string="Ordini spediti oggi" icon="terp-go-month"/>

                    <!--<field name="connector_id"/>
                    <field name="wp_date_created"/>
                    -->
                    <field name="is_prime" invisible="1"/>
                    <field name="marketplace" readonly="1"/>
                    <field name="name" readonly="1"/>
                    <field name="date_order" readonly="1"/>
                    <field name="traking_date" readonly="1" string="Consegna"/>
                    <field name="partner_name" readonly="1"/>
                    <field name="shipping" readonly="1"/>

                    <field name="carrier_parcel_template_id" domain="['|',('carrier_supplier_id','=',False),('carrier_supplier_id','=',carrier_supplier_id)]" />
                    <field name="parcel_weight_tree" string="Imballi"/>
                    <button name="load_template_parcel" string="Add parcel" icon="gtk-add" type="object" attrs="{'invisible': [('carrier_parcel_template_id','=',False)]}" class="oe_highlight" />
                    <button name="generate_parcel_from_order" type="object" string="Genera colli da ordine" icon="gtk-execute" confirm="I colli verranno ricalcolati da quelli nei prodotti in ordine, confermi?"/>

                    <field name="parcel_detail" readonly="1" string="Colli"/>
                    <button name="product_detail_delivery_button" type="object" string="Dettaglio di spedizione" icon="gtk-info" />
                    <field name="delivery_detail" readonly="1"/>

                    <field name="parcel_ids" invisible="1"/>
                    <field name="ship_type" invisible="1"/>
                    <field name="package_type" invisible="1"/>
                    <field name="carrier_cost_lossy" invisible="1"/>

                    <button name="choose_best_delivery_button" type="object" string="Scegli corriere migliore" icon="gtk-refresh" />
                    <field name="carrier_supplier_id" string="Broker"/>
                    <field name="carrier_mode_id" string="Servizio"/>
                    <field name="courier_supplier_id" string="Corriere"/> <!--readonly="1"-->
                    <field name="courier_mode_id" string="Modalità"/> <!--readonly="1"-->
                    <button name="carrier_get_better_option" type="object" string="Get better option" icon="STOCK_SORT_DESCENDING" attrs="{'invisible': [('carrier_track_id', '!=', False)]}" />
                    <button name="carrier_get_reservation" type="object" string="Prenota consegna" icon="gtk-ok" attrs="{'invisible': [('carrier_track_id', '!=', False)]}" confirm="Confermi prenotazione consegna al portale?"/>
                    <button name="carrier_remove_reservation" type="object" string="Rimuovi prenotazione" icon="gtk-cancel" attrs="{'invisible': [('master_tracking_id', '=', False), ('carrier_track_id', '=', False)]}" confirm="Vuoi rimuovere la prenotazione dal portale (se non è già stata ritirata la merce)?"/>
                    <button name="print_label" type="object" string="Scarica e stampa etichetta" icon="gtk-print" attrs="{'invisible': [('carrier_track_id', '=', False)]}"/>
                    <!-- todo for MBE: <button name="carrier_print_label" type="object" string="Print label" icon="gtk-print" attrs="{'invisible': [('carrier_track_id', '=', False)]}"/>-->

                    <field name="master_tracking_id" invisible="1"/>
                    <field name="carrier_track_id" invisible="1"/>
                    <field name="zone_id" readonly="1"/>
                    <field name="pricelist_shipping_total" readonly="1" sum="Sped. list." />
                    <field name="carrier_cost" readonly="1" sum="Sped. sito" />
                    <field name="real_shipping_total" sum="Sped. reale" />
                    <field name="carrier_state" invisible="1"/>
                    <field name="carrier_ok" invisible="1"/>
                    <field name="state" invisible="1"/>
                    <field name="carrier_state" invisible="1" />
                    <field name="label_printed" invisible="1" />

                    <!--<field name="soap_last_error" invisible="1"/>
                    <button name="soap_comment_last_error" string="Last error present" type="object" attrs="{'invisible': [('soap_last_error', '=', False)]}" icon="fa-exclamation-triangle fa-2x" />-->
                    <field name="state" />
                </tree>
            </field>
        </record>
        <record id="carrier_sale_order_action_all" model="ir.actions.act_window">
            <field name="name">Ordini con spedizione tutti</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', 'not in', ('failed', 'cancelled', 'trash', 'on-hold', 'pending'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action" model="ir.actions.act_window">
            <field name="name">Ordini con spedizione</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'draft'),('state', 'not in', ('failed', 'cancelled', 'trash', 'on-hold', 'pending'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_pending" model="ir.actions.act_window">
            <field name="name">Ordini con spedizione pendenti</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'pending'),('state', 'not in', ('failed', 'cancelled', 'trash'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_sent" model="ir.actions.act_window">
            <field name="name">Ordini con spedizione spediti</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'sent'),('state', 'not in', ('failed', 'cancelled', 'trash'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_delivered" model="ir.actions.act_window">
            <field name="name">Ordini con spedizione consegnati</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_state', '=', 'delivered'),]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_label_to_print_action" model="ir.actions.act_window">
            <field name="name">Etichette da stampare</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('master_tracking_id', '!=', False),('label_printed', '=', False),('state', 'not in', ('failed', 'cancelled', 'trash'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>
        <record id="carrier_sale_order_action_lossy" model="ir.actions.act_window">
            <field name="name">Carrier order lossy</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wordpress.sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('carrier_cost_lossy', '=', True),('state', 'not in', ('failed', 'cancelled', 'trash'))]</field>
            <field name="view_id" ref="carrier_sale_order_tree"/>
        </record>

        <record model="ir.ui.view" id="view_sale_order_carrier_search">
            <field name="name">wordpress.sale.order.carrier.search</field>
            <field name="model">wordpress.sale.order</field>
            <field name="inherit_id" ref="wordpress_sale_order_view_search"/>
            <field name="arch" type="xml">
                <field name="currency" position="after">
                    <field name="carrier_track_id" />
                    <field name="carrier_supplier_id" />
                    <field name="carrier_mode_id" />
                    <field name="courier_supplier_id" />
                    <field name="courier_mode_id" />
                    <field name="master_tracking_id" />
                    <field name="system_reference_id" />
                    <field name="carrier_state" />
                    <field name="delivery_state" />
                    <!--<field name="line_ids" domain="[('line_ids', 'ilike', self)]" />-->

                    <filter name="real_shipping_total_on" string="Spediz. inserita" domain="[('real_shipping_total','&gt;', 0)]"/>
                    <filter name="real_shipping_total_off" string="Spediz. mancante" domain="[('real_shipping_total', '=', False)]"/>

                    <filter name="carrier_track_id_assigned" string="LDV generated" domain="[('carrier_track_id','!=',False)]"/>
                    <filter string="Stato spedizione" domain="[]" context="{'group_by': 'carrier_state'}"/>
                    <filter string="Stato consegna" domain="[]" context="{'group_by': 'delivery_state'}"/>
                    <filter name="carrier_parcel_assigned" string="Parcel assigned" domain="[('parcel_ids','!=',False)]"/>
                    <filter name="label_printed_no" string="Etichette non stampate" domain="[('label_printed','=',False)]"/>
                </field>
                <xpath expr="/search/group/filter[2]" position="after">
                    <filter string="Spedizioniere" domain="[]" context="{'group_by': 'carrier_supplier_id'}"/>
                    <filter string="Modo spedizioniere" domain="[]" context="{'group_by': 'carrier_mode_id'}"/>

                    <filter string="Corriere" domain="[]" context="{'group_by': 'courier_supplier_id'}"/>
                    <filter string="Modalità corriere" domain="[]" context="{'group_by': 'courier_mode_id'}"/>

                    <filter string="Data consegna" domain="[]" context="{'group_by': 'carrier_delivery_date'}"/>
                    <filter string="Data firma consegna" domain="[]" context="{'group_by': 'carrier_delivery_sign'}"/>
                    <filter string="Etichette stampate" domain="[]" context="{'group_by': 'label_printed'}"/>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="wordpress_sale_order_carrier_view_form">
            <field name="name">wordpress.sale.order.form</field>
            <field name="model">wordpress.sale.order</field>
            <field name="inherit_id" ref="wp_order.wordpress_sale_order_view_form"/>
            <field name="arch" type="xml">
                <field name="key" position="after">
                    <field name="carrier_connection_id" /> <!--attrs="{'invisible': [('soap_connection_id', '=', False)]}"-->
                </field>
                <xpath expr="//page[1]" position="after">
                    <page string="Carrier" name="carrier_page">
                        <group colspan="4" col="5">
                            <button name="set_carrier_ok_yes" string="Delivery confirmed" type="object" attrs="{'invisible': [('carrier_ok', '=', True)]}" icon="gtk-yes" colspan="1"/>
                            <button name="set_carrier_ok_no" string="Delivery undo" type="object" attrs="{'invisible': [('carrier_ok', '=', False)]}" icon="gtk-no" colspan="1"/>
                            <button name="carrier_print_label" type="object" string="Print label" icon="gtk-print" attrs="{'invisible': [('carrier_track_id', '=', False)]}"/>
                            <newline/>
                            <field name="carrier_ok" invisible="1" />
                        </group>

                        <group colspan="4" col="5" >
                            <field name="carrier_supplier_id" />
                            <field name="carrier_mode_id" />
                            <button name="carrier_get_better_option" type="object" string="Get better option" icon="STOCK_SORT_DESCENDING"/>

                            <field name="carrier_parcel_template_id" domain="['|',('carrier_supplier_id','=',False),('carrier_supplier_id','=',carrier_supplier_id)]"/>
                            <button name="load_template_parcel" string="Add" type="object" attrs="{'invisible': [('carrier_parcel_template_id','=',False)]}" colspan="1" class="oe_highlight"/>
                            <newline/>

                            <separator string="Parcel:" colspan="4"/>
                            <button name="generate_parcel_from_order" type="object" string="Genera colli da ordine" icon="gtk-execute" confirm="I colli verranno ricalcolati da quelli nei prodotti in ordine, confermi?"/>
                            <field name="parcel_ids" colspan="5" nolabel="1">
                                <tree string="Parcel" editable="bottom">
                                    <field name="length" />
                                    <field name="width" />
                                    <field name="height" />

                                    <field name="real_weight" sum="total_real"/>
                                    <field name="use_real_weight" />
                                    <field name="weight" sum="total_volumetric"/>
                                    <field name="no_label" />
                                </tree>
                            </field>
                            <newline/>
                        </group>

                        <group colspan="4" col="5">
                            <separator string="Partner check:" colspan="5"/>
                            <field name="carrier_check" colspan="5" readonly="1" nolabel="1" widget="html"/>
                            <newline/>
                        </group>

                        <group colspan="4" col="5" >
                            <separator string="Request:" colspan="4"/>
                            <button name="set_default_carrier_description" string="Force description" type="object" icon="gtk-execute"/>
                            <field name="carrier_description" colspan="5" />
                            <newline/>

                            <field name="carrier_note" />
                            <field name="carrier_stock_note" />
                            <newline/>

                            <field name="carrier_total" />
                            <field name="carrier_cash_delivery" />
                            <newline/>

                            <field name="carrier_ensurance" />
                            <field name="carrier_pay_mode" />
                            <newline/>
                        </group>

                        <!-- Common part: -->
                        <group colspan="4" col="4">
                            <separator string="Carrier reply:" colspan="4"/>
                            <field name="carrier_cost" />
                            <field name="carrier_track_id" />

                            <field name="master_tracking_id" /><!--readonly="1"-->
                            <field name="system_reference_id" readonly="1"/>

                            <field name="carrier_state" /><!--todo readonly="1"-->
                            <field name="delivery_state" readonly="1"/>

                            <field name="carrier_ok" />   <!--todo invisible="1"-->
                            <field name="shipper_type" />

                            <field name="ship_type" />
                            <field name="package_type" />

                            <field name="courier_supplier_id" />
                            <field name="courier_mode_id" />

                            <field name="carrier_delivery_date" />
                            <field name="carrier_delivery_sign" />

                            <button name="shipments_list_request_detail_source" type="object" string="Check MBE information" invisible="1"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- sale.order.carrier.zone -->
        <record model="ir.ui.view" id="view_sale_order_carrier_zone_tree">
            <field name="name">sale.order.carrier.zone.tree</field>
            <field name="model">sale.order.carrier.zone</field>
            <field name="arch" type="xml">
                <tree string="Zone">
                    <field name="base" />
                    <field name="broker_id" />
                    <field name="courier_id" />
                    <field name="name" />
                    <field name="description" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_sale_order_carrier_zone_form">
            <field name="name">sale.order.carrier.zone.form</field>
            <field name="model">sale.order.carrier.zone</field>
            <field name="arch" type="xml">
                <form string="Zone">
                    <sheet>
                        <group col="4">
                            <field name="name" />
                            <field name="base" />
                            <field name="broker_id" readonly="1"/>
                            <field name="courier_id" readonly="1"/>
                            <notebook colspan="4">
                                <page string="Extra" name="page_zone">
                                    <group col="4">
                                        <field name="zone_extra_ids" colspan="4" nolabel="1" context="{'default_courier_id': courier_id}"/>
                                    </group>
                                </page>
                                <page string="CAP" name="page_cap">
                                    <group col="4">
                                        <separator colspan="4" string="CAP:"/>
                                        <field name="cap" colspan="4" nolabel="1"/>
                                    </group>
                                </page>
                            </notebook>
                            <field name="description" colspan="4" nolabel="1"/>


                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!--carrier.supplier-->
        <record model="ir.ui.view" id="view_carrier_supplier_tree">
            <field name="name">carrier.supplier.tree</field>
            <field name="model">carrier.supplier</field>
            <field name="arch" type="xml">
                <tree string="Carrier supplier" editable="bottom">
                    <field name="hidden" />
                    <field name="broker_id" />
                    <field name="mode_id" />
                    <field name="name" />
                    <field name="mode" />
                    <field name="carrier_connection_id" attrs="{'required': [('mode', '=', 'carrier')]}"/>
                    <field name="carrier_mode" />
                    <field name="account_ref" />
                    <field name="accounting_ref" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_carrier_supplier_broker_tree">
            <field name="name">carrier.supplier.broker.tree</field>
            <field name="model">carrier.supplier</field>
            <field name="arch" type="xml">
                <tree string="Broker">
                    <field name="hidden" />
                    <field name="mode_id" invisible="1" />
                    <field name="name" />
                    <field name="mode" />
                    <field name="carrier_connection_id" attrs="{'required': [('mode', '=', 'carrier')]}"/>
                    <field name="carrier_mode" />
                    <field name="account_ref" />
                    <field name="accounting_ref" />
                    <button name="print_all_product_broker" string="Stampa listino" icon="gtk-print" type="object"/>
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_carrier_supplier_form">
            <field name="name">carrier.supplier.form</field>
            <field name="model">carrier.supplier</field>
            <field name="arch" type="xml">
                <form string="Broker">
                    <header>
                        <button name="print_all_product_broker" string="Stampa listino" icon="gtk-print" type="object"/>
                    </header>
                    <sheet>
                        <group col="4">
                            <field name="name" />
                            <field name="carrier_mode"/>
                            <field name="mode_id" invisible="1"/>
                            <notebook colspan="4">
                                <page string="Corrieri" name="page_courier">
                                    <group col="4">
                                        <field name="child_ids" colspan="4" nolabel="1" context="{'form_view_ref': 'wp_order.view_carrier_supplier_courier_form'}">
                                            <tree string="Corrieri">
                                                <field name="mode_id"/>
                                                <field name="name"/>
                                                <!--<field name="mode" />
                                                <field name="account_ref" />-->
                                                <field name="accounting_ref" />
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Modalità" name="page_mode">
                                    <group col="4">
                                        <field name="mode_ids" colspan="4" nolabel="1">
                                            <tree string="Modalità" editable="bottom" colors="grey:hidden == True">
                                                <field name="name"/>
                                                <field name="hidden" />
                                                <field name="account_ref" />
                                                <field name="cups_printer_id" />
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Zone broker" name="page_zone">
                                    <group col="4">
                                        <field name="broker_zone_ids" colspan="4" nolabel="1">
                                            <tree string="Zone">
                                                <field name="base"/>
                                                <field name="name"/>
                                                <field name="description"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Listino base broker" name="page_base_broker_pricelist">
                                    <group col="4">
                                        <field name="broker_base_ids" colspan="4" nolabel="1" context="{'default_broker_id': active_id}">
                                            <tree string="Listino base" editable="bottom" colors="blue: base==True">
                                                <field name="sequence" widget="handle"/>
                                                <field name="from_weight"/>
                                                <field name="to_weight"/>
                                                <field name="zone_id" domain="[('broker_id', '=', broker_id)]"/>
                                                <field name="broker_id" invisible="1"/>
                                                <field name="base" invisible="1"/>
                                                <field name="price"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Vincoli broker" name="page_constraint_broker">
                                    <group col="4">
                                        <field name="carrier_constraint_ids" colspan="4" nolabel="1"/>
                                    </group>
                                </page>
                                <page string="Extra" name="page_extra_cost">
                                    <group col="4">
                                        <field name="broker_extra_ids" colspan="4" nolabel="1" context="{'default_courier_id': False}"/>
                                    </group>
                                </page>
                                <page string="Pallet" name="page_detail" attrs="{'invisible': [('carrier_mode', '!=', 'auto')]}">
                                    <group col="4">
                                        <field name="pallet_ids" colspan="4" nolabel="1"/>
                                    </group>
                                </page>
                                <page string="Dettaglio" name="page_detail">
                                    <group col="4">
                                        <field name="hidden" />
                                        <field name="no_transport" />
                                        <field name="mode" />
                                        <field name="carrier_connection_id" attrs="{'required': [('mode', '=', 'carrier')]}"/>
                                        <field name="account_ref" />
                                        <field name="accounting_ref" />
                                        <field name="prime" attrs="{'invisible': [('mode', '!=', 'courier')]}"/>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_carrier_supplier_courier_form">
            <field name="name">carrier.supplier.courier.form</field>
            <field name="model">carrier.supplier</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <form string="Corriere">
                    <sheet>
                        <group col="4">
                            <field name="name" />
                            <field name="zone_mode_extra" />
                            <field name="mode_id" invisible="1"/>
                            <field name="broker_id" invisible="1"/>
                            <notebook colspan="4">
                                <page string="Listino base corriere" name="page_base_courier_pricelist">
                                    <group col="4">
                                        <field name="courier_base_ids" colspan="4" nolabel="1" context="{'default_zone_broker_id': broker_id, 'default_courier_id': active_id}" >
                                            <tree string="Listino base" editable="bottom" colors="blue: base==True">
                                                <field name="sequence" widget="handle"/>
                                                <field name="from_weight"/>
                                                <field name="to_weight"/>
                                                <field name="zone_id" domain="['|', ('broker_id', '=', zone_broker_id), ('courier_id', '=', courier_id)]"/>
                                                <field name="courier_id" invisible="1"/>
                                                <field name="zone_broker_id" invisible="1"/>
                                                <field name="base" invisible="1"/>
                                                <field name="price"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Modalità" name="page_mode">
                                    <group col="4">
                                        <field name="mode_ids" colspan="4" nolabel="1">
                                            <tree string="Modalità" editable="bottom" colors="grey:hidden == True">
                                                <field name="name"/>
                                                <field name="hidden" />
                                                <field name="account_ref" />
                                                <field name="cups_printer_id" />
                                            </tree>
                                        </field>
                                    </group>
                                </page>

                                <page string="Vincoli corriere" name="page_constraint_broker">
                                    <group col="4">
                                        <field name="carrier_constraint_ids" colspan="4" nolabel="1"/>
                                    </group>
                                </page>

                                <page string="Zone (broker)" name="page_extra_cost" attrs="{'invisible': [('zone_mode_extra', '=', 'courier')]}">
                                    <group col="4">
                                        <field name="broker_courier_extra_ids" colspan="4" nolabel="1" context="{'default_broker_id': broker_id}">
                                            <tree string="Costi corriere / broker extra:">
                                                <field name="zone_id" />
                                            </tree>
                                            <form>
                                                <sheet>
                                                    <group col="4">
                                                        <field name="zone_id" domain="[('broker_id', '=', broker_id)]"/>
                                                        <field name="broker_id" />
                                                        <field name="zone_extra_ids" colspan="4" nolabel="1"/>
                                                    </group>
                                                </sheet>
                                            </form>

                                        </field>
                                    </group>
                                </page>
                                <page string="Zone (corriere)" name="page_zone" attrs="{'invisible': [('zone_mode_extra', '=', 'broker')]}">
                                    <group col="4">
                                        <field name="courier_zone_ids" colspan="4" nolabel="1">
                                            <tree string="Zone">
                                                <field name="base"/>
                                                <field name="name"/>
                                                <field name="description"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Costi extra" name="page_extra_cost">
                                    <group col="4">
                                        <field name="courier_extra_ids" colspan="4" nolabel="1"  context="{'default_courier_id': active_id}"/>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_supplier_form">
            <field name="name">Carrier supplier</field>
            <field name="res_model">carrier.supplier</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_carrier_supplier_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <record model="ir.actions.act_window" id="action_carrier_supplier_zone_tree">
            <field name="name">Broker</field>
            <field name="res_model">carrier.supplier</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_carrier_supplier_broker_tree"/>
            <field name="context">{}</field>
            <field name="domain">[('mode', '=', 'carrier')]</field>
        </record>

        <!--carrier.supplier.mode-->
        <record model="ir.ui.view" id="view_carrier_supplier_mode_tree">
            <field name="name">carrier.supplier.mode.tree</field>
            <field name="model">carrier.supplier.mode</field>
            <field name="arch" type="xml">
                <tree string="Carrier supplier mode" editable="bottom">
                    <field name="hidden" />
                    <field name="supplier_id" />
                    <field name="name" />
                    <field name="account_ref" />
                    <field name="cups_printer_id" />
                    <!--<field name="mode" />-->
                    <!--<field name="connection_id" attrs="{'required': [('mode', '=', 'carrier')]}"/>-->
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_supplier_mode">
            <field name="name">Carrier mode</field>
            <field name="res_model">carrier.supplier.mode</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_carrier_supplier_mode_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--carrier.parcel.template-->
        <record model="ir.ui.view" id="view_carrier_parcel_template_tree">
            <field name="name">carrier.parcel.template.tree</field>
            <field name="model">carrier.parcel.template</field>
            <field name="arch" type="xml">
                <tree string="Parcel template" editable="bottom" decoration-primary="carrier_supplier_id==False">
                    <field name="carrier_supplier_id" />
                    <field name="carrier_connection_id" />
                    <field name="package_type" />

                    <field name="name" />
                    <field name="length" />
                    <field name="width" />
                    <field name="height" />
                    <field name="weight" />
                    <field name="no_label" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_carrier_parcel_template_form">
            <field name="name">carrier.parcel.template.form</field>
            <field name="model">carrier.parcel.template</field>
            <field name="arch" type="xml">
                <form string="Parcel template">
                    <sheet>
                        <group colspan="4" col="6">
                            <field name="carrier_supplier_id" />
                            <field name="carrier_connection_id" />
                            <field name="package_type" />

                            <field name="name" />
                            <field name="weight" />

                            <field name="length" />
                            <field name="width" />
                            <field name="height" />

                            <field name="no_label" />
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_carrier_parcel_template_tree">
            <field name="name">Parcel template</field>
            <field name="res_model">carrier.parcel.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_carrier_parcel_template_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <menuitem
            parent="connector_web_base.menu_webserver_root"
            id="menu_connector_wordpress_carrier"
            name="Corriere"
            sequence="30"
            />
            <menuitem
                    id="carrier_root_menu"
                    parent="menu_connector_wordpress_carrier"
                    name="Spedizioni"
                    sequence="10"/>
                <menuitem
                    id="carrier_sale_order_action_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_action"
                    sequence="10"/>
                <menuitem
                    id="carrier_sale_order_action_print_label_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_label_to_print_action"
                    sequence="20"/>
                <menuitem
                    id="carrier_sale_order_action_pending_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_action_pending"
                    sequence="30"/>
                <menuitem
                    id="carrier_sale_order_action_sent_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_action_sent"
                    sequence="40"/>
                <menuitem
                    id="carrier_sale_order_action_delivered_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_action_delivered"
                    sequence="50"/>
                <menuitem
                    id="carrier_sale_order_action_all_menu"
                    parent="carrier_root_menu"
                    action="carrier_sale_order_action_all"
                    sequence="60"/>

            <menuitem
                    parent="menu_connector_wordpress_carrier"
                    id="menu_carrier_configuration"
                    name="Configurazione"
                    sequence="90"
                    />
                    <menuitem
                        id="carrier_connection_soap_menu"
                        parent="menu_carrier_configuration"
                        action="carrier_connection_action"
                        sequence="10"/>
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_parcel_template"
                        action="action_carrier_parcel_template_tree"
                        sequence="20"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_carrier_supplier"
                        action="action_carrier_supplier_form"
                        sequence="30"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_carrier_supplier_mode"
                        action="action_carrier_supplier_mode"
                        sequence="40"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_carrier_supplier_broker"
                        action="action_carrier_supplier_zone_tree"
                        sequence="80"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_product_product_web_server_carrier"
                        action="action_product_product_web_server"
                        sequence="90"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_product_product_web_transport_server"
                        action="action_product_product_web_transport_server"
                        sequence="100"
                        />
                    <menuitem
                        parent="menu_carrier_configuration"
                        id="menu_carrier_supplier_stored_data"
                        action="action_carrier_supplier_stored_data"
                        sequence="110"
                        />

    </data>
</openerp>
